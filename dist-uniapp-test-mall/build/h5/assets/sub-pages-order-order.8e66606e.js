import{d as e,o as t,c as s,w as a,a as l,b as u,t as d,z as r,g as n,s as o,p as c,D as i,u as f,h as m,r as x,F as p,E as _,B as v,n as b,e as y,aj as g,i as h,Z as w,q as j,v as k,I}from"./index.1710046744346.js";import{_ as P}from"./location.9ab97338.js";import{u as F}from"./useAddress.44d9d800.js";import{g as C,a as T,b as A,p as D}from"./order.e513a513.js";import{_ as L}from"./plugin-vueexport-helper.6cd7b27f.js";import"./address.247bf78a.js";import"./request.ff2c352d.js";const O=e({__name:"app-form-item-v2",props:{label:null},setup:e=>(o,c)=>{const i=n;return t(),s(i,{class:"p-3 between text-sm"},{default:a((()=>[l(i,{class:"w-fit"},{default:a((()=>[u(d(e.label),1)])),_:1}),l(i,{class:"flex-1 text-right"},{default:a((()=>[r(o.$slots,"default")])),_:3})])),_:3})}}),V=L(e({__name:"order",props:{id:null,count:null,addressId:null},setup(e){const r=e;!async function(){if(r.id&&!r.count){const{result:e}=await C(r.id);$.value=e}else if(r.id&&r.count){const{result:e}=await T({skuId:r.id,count:r.count});$.value=e}else{const{result:e}=await A();$.value=e}}();const L=F(),{address:V,addressList:q}=o(L),z=[{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}],$=c();L.getAddressListData();const B=i((()=>{var e,t;return r.addressId?null==(e=q.value)?void 0:e.find((e=>e.id==r.addressId)):Object.keys(V.value||{}).length>0?V.value:null==(t=$.value)?void 0:t.userAddresses.find((e=>e.isDefault))})),E=i((()=>Object.keys(B.value||{}).length>0)),M=c(0),U=e=>{M.value=e.detail.value},Z=c(""),G=()=>{b({url:"/sub-pages/address/address"})},H=async()=>{if(!E.value)return void y({title:"请选择收货地址",icon:"none"});const{result:e}=await D({addressId:B.value.id,buyerMessage:Z.value,deliveryTimeType:M.value,goods:$.value.goods.map((e=>({count:e.count,skuId:e.skuId}))),payChannel:2,payType:1});y({title:"提交订单成功",icon:"none",success:()=>{g({url:`/sub-pages/order-detail/order-detail?id=${e.id}`})}})};return(e,r)=>{const o=h,c=n,i=w,b=j(k("app-form-item-v2"),O),y=I;return t(),s(c,{class:"m-3 pb-60px"},{default:a((()=>[l(c,{class:"bg-white p-3 center-y mb-2 rounded-1",onClick:G},{default:a((()=>[l(o,{class:"w-7 h-7",src:P}),l(c,{class:"ml-2 between flex-1"},{default:a((()=>[f(B)&&Object.keys(f(B)).length>0?(t(),s(c,{key:0,class:"text-sm"},{default:a((()=>[l(c,{class:"text-[#666]"},{default:a((()=>{var e,t;return[u(d(null==(e=f(B))?void 0:e.receiver)+" "+d(null==(t=f(B))?void 0:t.contact),1)]})),_:1}),l(c,{class:"text-[#999]"},{default:a((()=>{var e;return[u(d(null==(e=f(B))?void 0:e.fullLocation),1)]})),_:1})])),_:1})):(t(),s(c,{key:1,class:"text-[#666]"},{default:a((()=>[u("请选择收获地址")])),_:1})),l(c,{class:"i-carbon-chevron-right w-6 h-6 text-[#999]"})])),_:1})])),_:1}),l(c,{class:"bg-white mb-2 rounded-1"},{default:a((()=>{var e;return[(t(!0),m(p,null,x(null==(e=f($))?void 0:e.goods,(e=>(t(),s(c,{class:"mx-3 py-3 b-bottom center-y",key:e.id},{default:a((()=>[l(o,{class:"w-20 h-20 rounded-2 mr-2",src:e.picture},null,8,["src"]),l(c,{class:"flex-1 between h-20 flex-col items-start"},{default:a((()=>[l(c,{class:"text-sm"},{default:a((()=>[u(d(e.name),1)])),_:2},1024),l(c,{class:"w-full"},{default:a((()=>[l(c,{class:"bg-[#f7f7f8] text-xs px-2 py-0.25 text-[#999] mb-1 w-fit max-w-200px truncate"},{default:a((()=>[u(d(e.attrsText),1)])),_:2},1024),l(c,{class:"between w-full"},{default:a((()=>[l(c,{class:"flex items-end"},{default:a((()=>[l(c,{class:"mr-0.5 text-xs text-[#f00]"},{default:a((()=>[u(" ¥ ")])),_:1}),l(c,{class:"text-[#f00]"},{default:a((()=>[u(d(e.totalPayPrice),1)])),_:2},1024),l(c,{class:"text-xs text-[#999] ml-1 line-through"},{default:a((()=>[u("¥"+d(e.totalPrice),1)])),_:2},1024)])),_:2},1024),l(c,{class:"text-sm"},{default:a((()=>[u("x"+d(e.count),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))]})),_:1}),l(c,{class:"bg-white text-sm mb-2 rounded-1"},{default:a((()=>[l(b,{label:"配送时间"},{default:a((()=>[l(i,{range:z,mode:"selector","range-key":"text",onChange:U},{default:a((()=>[l(c,{class:"center-y text-[#666] justify-end w-full"},{default:a((()=>[l(c,null,{default:a((()=>[u(d(z[f(M)].text),1)])),_:1}),l(c,{class:"i-carbon-chevron-right"})])),_:1})])),_:1})])),_:1}),l(b,{label:"订单备注"},{default:a((()=>[l(y,{modelValue:f(Z),"onUpdate:modelValue":r[0]||(r[0]=e=>_(Z)?Z.value=e:null),class:"text-sm","cursor-spacing":30,placeholder:"选题，建议留言前先与商家沟通确认"},null,8,["modelValue"])])),_:1})])),_:1}),l(c,{class:"bg-white text-sm rounded-1"},{default:a((()=>[l(b,{label:"商品总价:"},{default:a((()=>[l(c,null,{default:a((()=>{var e;return[u("¥"+d(null==(e=f($))?void 0:e.summary.totalPrice.toFixed(2)),1)]})),_:1})])),_:1}),l(b,{label:"运费:"},{default:a((()=>[l(c,null,{default:a((()=>{var e;return[u("¥"+d(null==(e=f($))?void 0:e.summary.postFee.toFixed(2)),1)]})),_:1})])),_:1})])),_:1}),l(c,{class:"fixed left-0 right-0 bottom-0 h-50px bg-white between px-3"},{default:a((()=>[l(c,{class:"text-[#f00] center-y"},{default:a((()=>[l(c,null,{default:a((()=>[u("¥")])),_:1}),l(c,{class:"text-lg ml-0.25"},{default:a((()=>{var e;return[u(d(null==(e=f($))?void 0:e.summary.totalPayPrice.toFixed(2)),1)]})),_:1})])),_:1}),l(c,{class:v(["bg-[#fbb957] text-white px-7 py-1.5 rounded-full text-sm",{"opacity-50":!f(E)}]),onClick:H},{default:a((()=>[u("提交订单")])),_:1},8,["class"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-a9404118"]]);export{V as default};