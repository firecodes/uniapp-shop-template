import{_ as O,u as x,j as L,a as P,o as S,q as B,ao as T,f as u,ap as q,x as J,a2 as A,b as m,c as h,e as c,d as s,t as o,F as D,l as V,w as _,aq as $,h as I,p as j,i as E,g as F,I as R}from"./index-b6baaa43.js";import{B as H}from"./index-c2ffc462.js";import{s as M}from"./SimpleHeader-eb02e727.js";import{g as U,a as z}from"./address-f7da8579.js";import{c as G,p as K}from"./order-7deb7202.js";import"./use-route-29860e60.js";const Q=i=>(j("data-v-4f75e7fd"),i=i(),E(),i),W={class:"create-order"},X={class:"address-wrap"},Y={class:"address"},Z={class:"good"},ss={class:"good-img"},es=["src"],ts={class:"good-desc"},as={class:"good-title"},os={class:"good-btn"},rs={class:"price"},ds={class:"pay-wrap"},cs={class:"price"},ns=Q(()=>s("span",null,"商品金额",-1)),is={style:{width:"90%",margin:"0 auto",padding:"50px 0"}},ls={__name:"CreateOrder",setup(i){const l=x(),f=L(),e=P({cartList:[],address:{},showPay:!1,orderNo:"",cartItemIds:[]});S(()=>{y()});const y=async()=>{B({message:"加载中...",forbidClick:!0});const{addressId:a,cartItemIds:t}=f.query,d=JSON.parse(t||T("cartItemIds"));u("cartItemIds",JSON.stringify(d));const{data:n}=await q({cartItemIds:d.join(",")}),{data:p}=a?await U(a):await z();if(!p){l.push({path:"/address"});return}e.cartList=n,e.address=p,J()},v=()=>{l.push({path:"/address",query:{cartItemIds:JSON.stringify(e.cartItemIds),from:"create-order"}})},w=()=>{u("cartItemIds","")},C=async()=>{const a={addressId:e.address.addressId,cartItemIds:e.cartList.map(d=>d.cartItemId)},{data:t}=await G(a);u("cartItemIds",""),e.orderNo=t,e.showPay=!0},N=()=>{l.push({path:"/order"})},g=async a=>{await K({orderNo:e.orderNo,payType:a}),F("支付成功"),setTimeout(()=>{l.push({path:"/order"})},2e3)},k=A(()=>{let a=0;return e.cartList.forEach(t=>{a+=t.goodsCount*t.sellingPrice}),a});return(a,t)=>{const d=R,n=H,p=$;return m(),h("div",W,[c(M,{name:"生成订单",onCallback:w}),s("div",X,[s("div",{class:"name",onClick:v},[s("span",null,o(e.address.userName),1),s("span",null,o(e.address.userPhone),1)]),s("div",Y,o(e.address.provinceName)+" "+o(e.address.cityName)+" "+o(e.address.regionName)+" "+o(e.address.detailAddress),1),c(d,{class:"arrow",name:"arrow"})]),s("div",Z,[(m(!0),h(D,null,V(e.cartList,(r,b)=>(m(),h("div",{class:"good-item",key:b},[s("div",ss,[s("img",{src:a.$filters.prefix(r.goodsCoverImg),alt:""},null,8,es)]),s("div",ts,[s("div",as,[s("span",null,o(r.goodsName),1),s("span",null,"x"+o(r.goodsCount),1)]),s("div",os,[s("div",rs,"¥"+o(r.sellingPrice),1)])])]))),128))]),s("div",ds,[s("div",cs,[ns,s("span",null,"¥"+o(k.value),1)]),c(n,{onClick:C,class:"pay-btn",color:"#1baeae",type:"primary",block:""},{default:_(()=>[I("生成订单")]),_:1})]),c(p,{closeable:"","close-on-click-overlay":!1,show:e.showPay,"onUpdate:show":t[2]||(t[2]=r=>e.showPay=r),position:"bottom",style:{height:"30%"},onClose:N},{default:_(()=>[s("div",is,[c(n,{style:{marginBottom:"10px"},color:"#1989fa",block:"",onClick:t[0]||(t[0]=r=>g(1))},{default:_(()=>[I("支付宝支付")]),_:1}),c(n,{color:"#4fc08d",block:"",onClick:t[1]||(t[1]=r=>g(2))},{default:_(()=>[I("微信支付")]),_:1})])]),_:1},8,["show"])])}}},gs=O(ls,[["__scopeId","data-v-4f75e7fd"]]);export{gs as default};
