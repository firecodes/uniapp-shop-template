import{B as W,G as D,W as _e,X as R,Y as ne,Z as ae,e as c,D as P,$ as ee,a0 as ke,C as Ce,a1 as w,H as pe,a2 as V,a3 as xe,J as te,L as O,a4 as $,r as L,a5 as oe,a6 as ye,k as X,a7 as J,a8 as se,a9 as ie,aa as K,O as Se,ab as Ie,ac as U,ad as fe,ae as Te,af as Pe,I as Ve,a as he,ag as Be,ah as we,ai as $e,aj as Ee,ak as Ne,u as Ae,M as Le,o as Ge,q as ce,al as Fe,x as ue,b as M,c as Y,d as y,w as A,Q as re,A as de,s as j,F as Me,l as Re,t as Q,h as me,n as We,am as De,an as Oe}from"./index-b6baaa43.js";import{B as ge}from"./index-c2ffc462.js";import{c as He,s as ze}from"./index-f0222efe.js";import{s as qe}from"./SimpleHeader-eb02e727.js";import{u as Ue}from"./use-placeholder-eae2f82f.js";import"./use-route-29860e60.js";const[be,Ke]=W("checkbox-group"),Xe={max:P,shape:ee("round"),disabled:Boolean,iconSize:P,direction:String,modelValue:ke(),checkedColor:String},ve=Symbol(be);var Je=D({name:be,props:Xe,emits:["change","update:modelValue"],setup(e,{emit:d,slots:r}){const{children:n,linkChildren:m}=_e(ve),v=l=>d("update:modelValue",l),o=(l={})=>{typeof l=="boolean"&&(l={checked:l});const{checked:g,skipDisabled:C}=l,u=n.filter(a=>a.props.bindGroup?a.props.disabled&&C?a.checked.value:g??!a.checked.value:!1).map(a=>a.name);v(u)};return R(()=>e.modelValue,l=>d("change",l)),ne({toggleAll:o}),ae(()=>e.modelValue),m({props:e,updateValue:v}),()=>{var l;return c("div",{class:Ke([e.direction])},[(l=r.default)==null?void 0:l.call(r)])}}});const[Ye,je]=W("checkbox"),Qe=Ce({},He,{shape:String,bindGroup:w,indeterminate:{type:Boolean,default:null}});var Ze=D({name:Ye,props:Qe,emits:["change","update:modelValue"],setup(e,{emit:d,slots:r}){const{parent:n}=pe(ve),m=l=>{const{name:g}=e,{max:C,modelValue:s}=n.props,u=s.slice();if(l)!(C&&u.length>=+C)&&!u.includes(g)&&(u.push(g),e.bindGroup&&n.updateValue(u));else{const a=u.indexOf(g);a!==-1&&(u.splice(a,1),e.bindGroup&&n.updateValue(u))}},v=V(()=>n&&e.bindGroup?n.props.modelValue.indexOf(e.name)!==-1:!!e.modelValue),o=(l=!v.value)=>{n&&e.bindGroup?m(l):d("update:modelValue",l),e.indeterminate!==null&&d("change",l)};return R(()=>e.modelValue,l=>{e.indeterminate===null&&d("change",l)}),ne({toggle:o,props:e,checked:v}),ae(()=>e.modelValue),()=>c(ze,te({bem:je,role:"checkbox",parent:n,checked:v.value,onToggle:o},e),xe(r,["default","icon"]))}});const et=O(Ze),tt=O(Je),[nt,z]=W("stepper"),at=200,q=(e,d)=>String(e)===String(d),lt={min:$(1),max:$(1/0),name:$(""),step:$(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:w,showMinus:w,showInput:w,longPress:w,autoFixed:w,allowEmpty:Boolean,modelValue:P,inputWidth:P,buttonSize:P,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:$(1),decimalLength:P};var ot=D({name:nt,props:lt,emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:d}){const r=(t,i=!0)=>{const{min:h,max:N,allowEmpty:p,decimalLength:H}=e;return p&&t===""||(t=ie(String(t),!e.integer),t=t===""?0:+t,t=Number.isNaN(t)?+h:t,t=i?Math.max(Math.min(+N,t),+h):t,K(H)&&(t=t.toFixed(+H))),t},n=()=>{var t;const i=(t=e.modelValue)!=null?t:e.defaultValue,h=r(i);return q(h,e.modelValue)||d("update:modelValue",h),h};let m;const v=L(),o=L(n()),l=V(()=>e.disabled||e.disableMinus||+o.value<=+e.min),g=V(()=>e.disabled||e.disablePlus||+o.value>=+e.max),C=V(()=>({width:oe(e.inputWidth),height:oe(e.buttonSize)})),s=V(()=>ye(e.buttonSize)),u=()=>{const t=r(o.value);q(t,o.value)||(o.value=t)},a=t=>{e.beforeChange?fe(e.beforeChange,{args:[t],done(){o.value=t}}):o.value=t},f=()=>{if(m==="plus"&&g.value||m==="minus"&&l.value){d("overlimit",m);return}const t=m==="minus"?-e.step:+e.step,i=r(Te(+o.value,t));a(i),d(m)},b=t=>{const i=t.target,{value:h}=i,{decimalLength:N}=e;let p=ie(String(h),!e.integer);if(K(N)&&p.includes(".")){const le=p.split(".");p=`${le[0]}.${le[1].slice(0,+N)}`}e.beforeChange?i.value=String(o.value):q(h,p)||(i.value=p);const H=p===String(+p);a(H?+p:p)},x=t=>{var i;e.disableInput?(i=v.value)==null||i.blur():d("focus",t)},k=t=>{const i=t.target,h=r(i.value,e.autoFixed);i.value=String(h),o.value=h,Se(()=>{d("blur",t),Ie()})};let I,T;const E=()=>{T=setTimeout(()=>{f(),E()},at)},_=()=>{e.longPress&&(I=!1,clearTimeout(T),T=setTimeout(()=>{I=!0,f(),E()},Pe))},B=t=>{e.longPress&&(clearTimeout(T),I&&U(t))},G=t=>{e.disableInput&&U(t)},F=t=>({onClick:i=>{U(i),m=t,f()},onTouchstartPassive:()=>{m=t,_()},onTouchend:B,onTouchcancel:B});return R(()=>[e.max,e.min,e.integer,e.decimalLength],u),R(()=>e.modelValue,t=>{q(t,o.value)||(o.value=r(t))}),R(o,t=>{d("update:modelValue",t),d("change",t,{name:e.name})}),ae(()=>e.modelValue),()=>c("div",{role:"group",class:z([e.theme])},[X(c("button",te({type:"button",style:s.value,class:[z("minus",{disabled:l.value}),{[se]:!l.value}],"aria-disabled":l.value||void 0},F("minus")),null),[[J,e.showMinus]]),X(c("input",{ref:v,type:e.integer?"tel":"text",role:"spinbutton",class:z("input"),value:o.value,style:C.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":o.value,onBlur:k,onInput:b,onFocus:x,onMousedown:G},null),[[J,e.showInput]]),X(c("button",te({type:"button",style:s.value,class:[z("plus",{disabled:g.value}),{[se]:!g.value}],"aria-disabled":g.value||void 0},F("plus")),null),[[J,e.showPlus]])])}});const st=O(ot),[it,S,ct]=W("submit-bar"),ut={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,currency:ee("¥"),disabled:Boolean,textAlign:String,buttonText:String,buttonType:ee("danger"),buttonColor:String,suffixLabel:String,placeholder:Boolean,decimalLength:$(2),safeAreaInsetBottom:w};var rt=D({name:it,props:ut,emits:["submit"],setup(e,{emit:d,slots:r}){const n=L(),m=Ue(n,S),v=()=>{const{price:s,label:u,currency:a,textAlign:f,suffixLabel:b,decimalLength:x}=e;if(typeof s=="number"){const k=(s/100).toFixed(+x).split("."),I=x?`.${k[1]}`:"";return c("div",{class:S("text"),style:{textAlign:f}},[c("span",null,[u||ct("label")]),c("span",{class:S("price")},[a,c("span",{class:S("price-integer")},[k[0]]),I]),b&&c("span",{class:S("suffix-label")},[b])])}},o=()=>{var s;const{tip:u,tipIcon:a}=e;if(r.tip||u)return c("div",{class:S("tip")},[a&&c(Ve,{class:S("tip-icon"),name:a},null),u&&c("span",{class:S("tip-text")},[u]),(s=r.tip)==null?void 0:s.call(r)])},l=()=>d("submit"),g=()=>r.button?r.button():c(ge,{round:!0,type:e.buttonType,text:e.buttonText,class:S("button",e.buttonType),color:e.buttonColor,loading:e.loading,disabled:e.disabled,onClick:l},null),C=()=>{var s,u;return c("div",{ref:n,class:[S(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(s=r.top)==null?void 0:s.call(r),o(),c("div",{class:S("bar")},[(u=r.default)==null?void 0:u.call(r),v(),g()])])};return()=>e.placeholder?m(C):C()}});const dt=O(rt),[mt,Z]=W("swipe-cell"),ft={name:$(""),disabled:Boolean,leftWidth:P,rightWidth:P,beforeClose:Function,stopPropagation:Boolean};var ht=D({name:mt,props:ft,emits:["open","close","click"],setup(e,{emit:d,slots:r}){let n,m,v,o;const l=L(),g=L(),C=L(),s=he({offset:0,dragging:!1}),u=Be(),a=t=>t.value?Ee(t).width:0,f=V(()=>K(e.leftWidth)?+e.leftWidth:a(g)),b=V(()=>K(e.rightWidth)?+e.rightWidth:a(C)),x=t=>{s.offset=t==="left"?f.value:-b.value,n||(n=!0,d("open",{name:e.name,position:t}))},k=t=>{s.offset=0,n&&(n=!1,d("close",{name:e.name,position:t}))},I=t=>{const i=Math.abs(s.offset),h=.15,N=n?1-h:h,p=t==="left"?f.value:b.value;p&&i>p*N?x(t):k(t)},T=t=>{e.disabled||(v=s.offset,u.start(t))},E=t=>{if(e.disabled)return;const{deltaX:i}=u;u.move(t),u.isHorizontal()&&(m=!0,s.dragging=!0,(!n||i.value*v<0)&&U(t,e.stopPropagation),s.offset=Ne(i.value+v,-b.value,f.value))},_=()=>{s.dragging&&(s.dragging=!1,I(s.offset>0?"left":"right"),setTimeout(()=>{m=!1},0))},B=(t="outside")=>{o||(d("click",t),n&&!m&&(o=!0,fe(e.beforeClose,{args:[{name:e.name,position:t}],done:()=>{o=!1,k(t)},canceled:()=>o=!1,error:()=>o=!1})))},G=(t,i)=>h=>{i&&h.stopPropagation(),B(t)},F=(t,i)=>{const h=r[t];if(h)return c("div",{ref:i,class:Z(t),onClick:G(t,!0)},[h()])};return ne({open:x,close:k}),we(l,()=>B("outside"),{eventName:"touchstart"}),$e("touchmove",E,{target:l}),()=>{var t;const i={transform:`translate3d(${s.offset}px, 0, 0)`,transitionDuration:s.dragging?"0s":".6s"};return c("div",{ref:l,class:Z(),onClick:G("cell",m),onTouchstartPassive:T,onTouchend:_,onTouchcancel:_},[c("div",{class:Z("wrapper"),style:i},[F("left",g),(t=r.default)==null?void 0:t.call(r),F("right",C)])])}}});const gt=O(ht);const bt={class:"cart-box"},vt={class:"cart-body"},_t={class:"good-item"},kt={class:"good-img"},Ct=["src"],pt={class:"good-desc"},xt={class:"good-title"},yt={class:"good-btn"},St={class:"price"},It={key:1,class:"empty"},Tt=y("img",{class:"empty-cart",src:"https://s.yezgea02.com/1604028375097/empty-car.png",alt:"空购物车"},null,-1),Pt=y("div",{class:"title"},"购物车空空如也",-1),At={__name:"Cart",setup(e){const d=Ae(),r=Le(),n=he({checked:!1,list:[],all:!1,result:[],checkAll:!0});Ge(()=>{m()});const m=async()=>{ce({message:"加载中...",forbidClick:!0});const{data:a}=await Fe({pageNumber:1});n.list=a,n.result=a.map(f=>f.cartItemId),ue()},v=V(()=>{let a=0;return n.list.filter(b=>n.result.includes(b.cartItemId)).forEach(b=>{a+=b.goodsCount*b.sellingPrice}),a}),o=()=>{d.push({path:"/home"})},l=async(a,f)=>{var x;if(a>5){j("超出单个商品的最大购买数量");return}if(a<1){j("商品不得小于0");return}if(((x=n.list.find(k=>k.cartItemId==f.name))==null?void 0:x.goodsCount)==a)return;ce({message:"修改中...",forbidClick:!0});const b={cartItemId:f.name,goodsCount:a};await De(b),n.list.forEach(k=>{k.cartItemId==f.name&&(k.goodsCount=a)}),ue()},g=async()=>{if(n.result.length==0){j("请选择商品进行结算");return}const a=JSON.stringify(n.result);d.push({path:"/create-order",query:{cartItemIds:a}})},C=async a=>{await Oe(a),r.updateCart(),m()},s=a=>{a.length==n.list.length?n.checkAll=!0:n.checkAll=!1,n.result=a},u=()=>{n.checkAll?n.result=[]:n.result=n.list.map(a=>a.cartItemId)};return(a,f)=>{const b=et,x=st,k=ge,I=gt,T=tt,E=dt;return M(),Y("div",bt,[c(qe,{name:"购物车",noback:!0}),y("div",vt,[c(T,{onChange:s,modelValue:n.result,"onUpdate:modelValue":f[0]||(f[0]=_=>n.result=_),ref:"checkboxGroup"},{default:A(()=>[(M(!0),Y(Me,null,Re(n.list,(_,B)=>(M(),re(I,{"right-width":50,key:B},{right:A(()=>[c(k,{square:"",icon:"delete",type:"danger",class:"delete-button",onClick:G=>C(_.cartItemId)},null,8,["onClick"])]),default:A(()=>[y("div",_t,[c(b,{name:_.cartItemId},null,8,["name"]),y("div",kt,[y("img",{src:a.$filters.prefix(_.goodsCoverImg),alt:""},null,8,Ct)]),y("div",pt,[y("div",xt,[y("span",null,Q(_.goodsName),1),y("span",null,"x"+Q(_.goodsCount),1)]),y("div",yt,[y("div",St,"¥"+Q(_.sellingPrice),1),c(x,{integer:"",min:1,max:5,"model-value":_.goodsCount,name:_.cartItemId,"async-change":"",onChange:l},null,8,["model-value","name"])])])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),n.list.length>0?(M(),re(E,{key:0,class:"submit-all van-hairline--top",price:v.value*100,"button-text":"结算","button-type":"primary",onSubmit:g},{default:A(()=>[c(b,{onClick:u,checked:n.checkAll,"onUpdate:checked":f[1]||(f[1]=_=>n.checkAll=_)},{default:A(()=>[me("全选")]),_:1},8,["checked"])]),_:1},8,["price"])):de("",!0),n.list.length?de("",!0):(M(),Y("div",It,[Tt,Pt,c(k,{round:"",color:"#1baeae",type:"primary",onClick:o,block:""},{default:A(()=>[me("前往选购")]),_:1})])),c(We)])}}};export{At as default};
