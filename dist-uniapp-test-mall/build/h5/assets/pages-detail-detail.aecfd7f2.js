import{d as e,q as t,v as o,o as l,h as s,a,w as r,b as n,F as u,r as c,c as i,g as d,t as f,i as p,e as m,G as g,A as b,B as y,m as k,N as h,O as C,P as _,j as x,l as v,Q as N,p as S,s as I,R as T,u as w,E as A,n as B,H as F,T as V,x as G,f as j,S as L,k as O}from"./index.1710046744346.js";import{_ as E}from"./app-shop-item-v1.vuevuetypescriptsetuptruelang.0f0b6f40.js";import{_ as D,b as $}from"./cart.a8868f3b.js";import{_ as J}from"./plugin-vueexport-helper.6cd7b27f.js";import{c as M}from"./cloneDeep.84f49581.js";import{_ as R}from"./location.9ab97338.js";import{u as P}from"./useAddress.44d9d800.js";import{_ as U}from"./app-popup.vuevuetypescriptsetuptruelang.cdd48243.js";import{_ as Q}from"./uni-icons.865f5f3c.js";import{_ as H}from"./app-scroll-view.25475bf7.js";import{g as K}from"./request.ff2c352d.js";import"./isObjectLike.53204146.js";import"./address.247bf78a.js";import"./useSystem.fcc01766.js";const q=e({__name:"detail-recommend",props:{goods:null},setup:e=>(f,p)=>{const m=d,g=t(o("app-shop-item-v1"),E);return l(),s(u,null,[a(m,{class:"mt-3 bg-white px-3 py-4"},{default:r((()=>[a(m,{class:"px-1 border-l-3 border-l-solid border-l-[#fbb957]"},{default:r((()=>[n("详情")])),_:1})])),_:1}),a(m,{class:"around flex-wrap w-full py-3"},{default:r((()=>[(l(!0),s(u,null,c(e.goods,(e=>(l(),i(g,{key:e.id,"guess-like":e},null,8,["guess-like"])))),128))])),_:1})],64)}}),z=e({__name:"detail-desc",props:{desc:null,pictures:null},setup:e=>(t,o)=>{const m=d,g=p;return l(),s(u,null,[a(m,{class:"mt-3 bg-white px-3 py-4"},{default:r((()=>[a(m,{class:"px-1 mb-3 border-l-3 border-l-solid border-l-[#fbb957]"},{default:r((()=>[n("详情")])),_:1}),(l(!0),s(u,null,c(e.desc,(e=>(l(),i(m,{class:"grid grid-cols-4 gap-2 py-2 font-thin text-[#000] text-sm border-b-1 border-b-dashed border-b-gray-300",key:e.name},{default:r((()=>[a(m,{classs:"px-1"},{default:r((()=>[n(f(e.name),1)])),_:2},1024),a(m,{class:"col-span-3"},{default:r((()=>[n(f(e.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),(l(!0),s(u,null,c(e.pictures,(e=>(l(),i(g,{class:"w-750rpx",key:e,src:e,mode:"widthFix"},null,8,["src"])))),128))],64)}});var X,Z={};const Y=J({name:"vk-data-goods-sku-popup",emits:["update:modelValue","input","update-goods","open","close","add-cart","buy-now","cart","buy","num-change"],props:{value:{Type:Boolean,default:!1},modelValue:{Type:Boolean,default:!1},goodsId:{Type:String,default:""},action:{Type:String,default:""},noStockText:{Type:String,default:"该商品已抢完"},stockText:{Type:String,default:"库存"},goodsIdName:{Type:String,default:"_id"},skuIdName:{Type:String,default:"_id"},skuListName:{Type:String,default:"sku_list"},specListName:{Type:String,default:"spec_list"},stockName:{Type:String,default:"stock"},skuArrName:{Type:String,default:"sku_name_arr"},defaultSingleSkuName:{Type:String,default:"默认"},mode:{Type:Number,default:1},maskCloseAble:{Type:Boolean,default:!0},borderRadius:{Type:[String,Number],default:0},goodsThumbName:{Type:[String],default:"goods_thumb"},goodsThumbBackgroundColor:{Type:String,default:"transparent"},minBuyNum:{Type:[Number,String],default:1},maxBuyNum:{Type:[Number,String],default:1e5},stepBuyNum:{Type:[Number,String],default:1},stepStrictly:{Type:Boolean,default:!1},customAction:{Type:[Function],default:null},localdata:{type:Object},priceColor:{Type:String},buyNowText:{Type:String,default:"立即购买"},buyNowColor:{Type:String},buyNowBackgroundColor:{Type:String},addCartText:{Type:String,default:"加入购物车"},addCartColor:{Type:String},addCartBackgroundColor:{Type:String},disableStyle:{Type:Object,default:null},activedStyle:{Type:Object,default:null},btnStyle:{Type:Object,default:null},showClose:{Type:Boolean,default:!0},closeImage:{Type:String,default:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAEyUlEQVR42sSZeWwNURTGp4OqtBo7sSXELragdkpQsRRJ1Zr4hyJiJ9YgxNIg1qANiT+E1i5IY0kVVWtQEbuEKLFGUSH27/ANN5PXmTvzupzkl/tm8t6b7517lnvvC0lKSjJ8WmnQAUSDFqABqALKgl8gD7wE90E2SAeXwFf1SxISErQeVtKHwCgwFsSDSIf3hYFKoCkYDBaDdyAViHdueHmoF6FtwDLQ23b/E7gM7oIcejIERIDaoBFoC8qA8mA8SQNz6W1XC9GY+nCQCCYAk/c+gF0gBZwH312+IxR0BCPBUIaH2A+wHsxHCHxx+gLT5QGN6a2JfG8uvVCDws9oiDQYlxkMGfHyQvARlADTwcXk5OT6foV2kS8ATXidymlcyen1a/Jjl9IJh3hPkjELYqO8Cu0KjjNZvtETw5jFBWXPmGSTGQKSeOn5iQ0kVLL0CINfPNcPbDMKyRCbGzEMBJ+ZD8cChYFdqGTqfsWT8otPGoVsEHsMwxDFs3shNsxJ6BrQ0Po8OGUUkVHsNCVml+cntB1jUWwn2GEUsTEMrASbDK+2CCQ0kYX6nfLLisMmKqUr0S60M+jG10vAm+JSCa8+x7CKlzHwaktV6DiObzUzPJIxFO1BQ12wGtTReO9GetVgY/kjNJzZbcWmTjHfxw51AsRqvL8eOAtmsJuFu3g1l+1ZLB5eDTVZ3K0P7tL0TkWOpSg61kVkBtuuNRthGs+wtJST5aQI7cEbkkRXNYVKgX6kIdYuUhYzMQwxN8tiExCLFqHNeSF9/aem0BzGp5PYQCJ7c/Gsk1RfuSD6U1dNpcDf9ZigTmKbMRZ9iVTsHscGJluW2FMf1SSQWGnBmaB6kCJVTVVNJZE++Cx9drEllS1KMCINpURFmEbBWA63Fz9s95cGIdJgp/zXmT4pZcOvSUzuZttTbblmnc3PIjjmidDXvKgdhMh0JdbzuCjWrbNOVovjS5P7bkPJ/mBESkz2BO0166ybNeJ431S2q+01NntuIq3E0amzjiZtk9tssWyTDzO4525bACK9NAUn68TtkNhpEXpOSagRml+S6iLSSeweHv242Qhl13rRyvoDvDlKyTQny/ZQJ+1iH7vVbEx7OR5UiKVIO7VicgvHCtwrudloMIV7/0uadVYW57O4Wvvi8v4pymlKkrpwvsDeLLZAY2pkwbAB3PSQfC+4cH7l4k1ZH8zkZRq8ecO+Z5rN40JJqnXFuGfaxPCTLjcn0OZOpnArXw8HY4paIbw5CcMgXq6HN2/mt6+XGLrN15tBryIUGavMpCTrfKcDCKkAceA9S8nhAOehhSUyhXpkBxxnP4YM1InugP7cBkjBPcqVUWFYCEROxXiQz5JlXV+IfKh7mpfJac+lZ6V87QXVClBkTc7YWsWTPSDyitfzUTlJlj8TbvE6jluDOdwZ+jX57GLO3ADeuyZrDYi86vV81FD2UVGsmT+5Zl0BnkhoseOEaogL46pqO4v/IqUEyalIR4h85BgjHv6+aUWRMbb7EstX6O0cpT1Gco0ry8fWygLDMjmDnQeBt3Qe7uVfkeugDwVLcsVzGsuwLXbV+I63XNAkG5r/hvgRqgqWs6pJPKrsbvz/Q6yyun0w/h6lP+BnzrCpfPMT2L8FGAA7k1GZ/vnaqAAAAABJRU5ErkJggg=="},hideStock:{Type:Boolean,default:!1},theme:{Type:String,default:"default"},actionTips:{Type:String,default:"请求中..."},defaultSelect:{Type:Object},useCache:{Type:Boolean,default:!0},defaultGoods:{Type:Object},amountType:{Type:Number,default:1},selectedInit:{Type:Boolean,default:!1},safeAreaInsetBottom:{Type:Boolean,default:!0}},data(){return{complete:!1,goodsInfo:{},isShow:!1,initKey:!0,shopItemInfo:{},selectArr:[],subIndex:[],selectShop:{},selectNum:this.minBuyNum||1,outFoStock:!1,openTime:0,themeColor:{default:{priceColor:"rgb(254, 86, 10)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(254, 86, 10)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(255, 148, 2)",btnStyle:{color:"#333333",borderColor:"#f4f4f4",backgroundColor:"#ffffff"},activedStyle:{color:"rgb(254, 86, 10)",borderColor:"rgb(254, 86, 10)",backgroundColor:"rgba(254,86,10,0.1)"},disableStyle:{color:"#c3c3c3",borderColor:"#f6f6f6",backgroundColor:"#f6f6f6"}},"red-black":{priceColor:"rgb(255, 68, 68)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(255, 68, 68)",addCartColor:"#ffffff",addCartBackgroundColor:"rgb(85, 85, 85)",activedStyle:{color:"rgb(255, 68, 68)",borderColor:"rgb(255, 68, 68)",backgroundColor:"rgba(255,68,68,0.1)"}},"black-white":{priceColor:"rgb(47, 47, 52)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(47, 47, 52)",addCartColor:"rgb(47, 47, 52)",addCartBackgroundColor:"rgb(235, 236, 242)",activedStyle:{color:"rgb(47, 47, 52)",borderColor:"rgba(47,47,52,0.12)",backgroundColor:"rgba(47,47,52,0.12)"}},coffee:{priceColor:"rgb(195, 167, 105)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(195, 167, 105)",addCartColor:"rgb(195, 167, 105)",addCartBackgroundColor:"rgb(243, 238, 225)",activedStyle:{color:"rgb(195, 167, 105)",borderColor:"rgb(195, 167, 105)",backgroundColor:"rgba(195, 167, 105,0.1)"}},green:{priceColor:"rgb(99, 190, 114)",buyNowColor:"#ffffff",buyNowBackgroundColor:"rgb(99, 190, 114)",addCartColor:"rgb(99, 190, 114)",addCartBackgroundColor:"rgb(225, 244, 227)",activedStyle:{color:"rgb(99, 190, 114)",borderColor:"rgb(99, 190, 114)",backgroundColor:"rgba(99, 190, 114,0.1)"}}}}},created(){let e=this;X=e.vk,e.valueCom&&e.open()},mounted(){},methods:{init(e){let t=this;t.selectArr=[],t.subIndex=[],t.selectShop={},t.selectNum=t.minBuyNum||1,t.outFoStock=!1,t.shopItemInfo={};let o=t.specListName;t.goodsInfo[o].map((e=>{t.selectArr.push(""),t.subIndex.push(-1)})),t.checkItem(),t.checkInpath(-1),e||t.autoClickSku()},findGoodsInfo(e={}){let t=this,{useCache:o}=e;if(void 0===X)return t.toast("custom-action必须是function","none"),!1;let{actionTips:l}=t,s="",a=!1;"custom"!==l?s=o?"":"请求中...":a=!o,X.callFunction({url:t.action,title:s,loading:a,data:{goods_id:t.goodsId},success(e){t.updateGoodsInfo(e.goodsInfo),Z[t.goodsId]=e.goodsInfo,t.$emit("update-goods",e.goodsInfo)},fail(){t.updateValue(!1)}})},updateValue(e){let t=this;e?(t.$emit("open",!0),t.$emit("input",!0),t.$emit("update:modelValue",!0)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},updateGoodsInfo(e){let t=this,{skuListName:o}=t;"{}"===JSON.stringify(t.goodsInfo)||t.goodsInfo[t.goodsIdName]!==e[t.goodsIdName]?(t.goodsInfo=e,t.initKey=!0):t.goodsInfo[o]=e[o],t.initKey&&(t.initKey=!1,t.init());let l=t.getListItem(t.goodsInfo[o],t.skuIdName,t.selectShop[t.skuIdName]);Object.assign(t.selectShop,l),t.defaultSelectSku(),t.complete=!0},async open(){let e=this;e.openTime=(new Date).getTime();let t=!0;e.skuListName;let o=!1,l=Z[e.goodsId];if(l&&e.useCache?(o=!0,e.updateGoodsInfo(l)):e.complete=!1,e.customAction&&"function"==typeof e.customAction){try{l=await e.customAction({useCache:o,goodsId:e.goodsId,goodsInfo:l,close:function(){setTimeout((function(){e.close()}),500)}}).catch((t=>{setTimeout((function(){e.close()}),500)}))}catch(s){let{message:t=""}=s;if(t.indexOf(".catch is not a function")>-1)return e.toast("custom-action必须返回一个Promise","none"),setTimeout((function(){e.close()}),500),!1}if(Z[e.goodsId]=l,!l||"object"!=typeof l||"{}"==JSON.stringify(l))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(l),e.updateValue(!0)}else if(void 0!==e.localdata&&null!==e.localdata){if(l=e.localdata,!l||"object"!=typeof l||"{}"==JSON.stringify(l))return e.toast("未获取到商品信息","none"),e.$emit("input",!1),!1;t=!1,e.updateGoodsInfo(l),e.updateValue(!0)}else t&&e.findGoodsInfo({useCache:o})},close(e){let t=this;if((new Date).getTime()-t.openTime<400)return!1;"mask"==e?!1!==t.maskCloseAble&&(t.$emit("input",!1),t.$emit("close","mask"),t.$emit("update:modelValue",!1)):(t.$emit("input",!1),t.$emit("close","close"),t.$emit("update:modelValue",!1))},moveHandle(){},skuClick(e,t,o){let l=this;e.ishow&&(l.selectArr[t]!=e.name?(l.$set(l.selectArr,t,e.name),l.$set(l.subIndex,t,o)):(l.$set(l.selectArr,t,""),l.$set(l.subIndex,t,-1)),l.checkInpath(t),l.checkSelectShop())},checkSelectShop(){let e=this;if(e.selectArr.every((e=>""!=e))){e.selectShop=e.shopItemInfo[e.getArrayToSting(e.selectArr)];let t=e.selectShop[e.stockName];void 0!==t&&e.selectNum>t&&(e.selectNum=t),e.selectNum>e.maxBuyNum&&(e.selectNum=e.maxBuyNum),e.selectNum<e.minBuyNum&&(e.selectNum=e.minBuyNum),e.selectedInit&&(e.selectNum=e.minBuyNum||1)}else e.selectShop={}},checkInpath(e){let t=this,o=t.specListName,l=t.goodsInfo[o];for(let s=0,a=l.length;s<a;s++){if(s==e)continue;let o=l[s].list.length;for(let e=0;e<o;e++){if(-1!=t.subIndex[s]&&e==t.subIndex[s])continue;let o=[...t.selectArr];t.$set(o,s,l[s].list[e].name);let a=o.filter((e=>""!==e&&void 0!==e));t.shopItemInfo.hasOwnProperty(t.getArrayToSting(a))?l[s].list[e].ishow=!0:l[s].list[e].ishow=!1}}t.$set(t.goodsInfo,o,l)},checkItem(){let e=this,{stockName:t}=e,o=e.skuListName,l=e.goodsInfo[o],s=[],a=0;l.map(((e,o)=>{e[t]>0&&(s.push(e),a+=e[t])})),a<=0&&(e.outFoStock=!0),s.reduce(((t,o)=>t.concat(o[e.skuArrName].reduce(((t,l)=>t.concat(t.map((t=>(e.shopItemInfo.hasOwnProperty(e.getArrayToSting([...t,l]))||(e.shopItemInfo[e.getArrayToSting([...t,l])]=o),[...t,l]))))),[[]]))),[[]])},getArrayToSting(e){let t="";return e.map(((e,o)=>{e=e.replace(/\./g,"。"),t+=0==o?e:","+e})),t},checkSelectComplete(e={}){let t=this,o=(new Date).getTime();if(t.clickTime&&o-t.clickTime<400)return!1;t.clickTime=o;let{selectShop:l,selectNum:s,stockText:a,stockName:r}=t;return l&&l[t.skuIdName]?s<=0?(t.toast("购买数量必须>0","none"),!1):s>l[r]?(t.toast(a+"不足","none"),!1):void("function"==typeof e.success&&e.success(l)):(t.toast("请先选择对应规格","none"),!1)},addCart(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("add-cart",t),e.$emit("cart",t)}})},buyNow(){let e=this;e.checkSelectComplete({success:function(t){t.buy_num=e.selectNum,e.$emit("buy-now",t),e.$emit("buy",t)}})},toast(e,t){m({title:e,icon:t})},getListItem(e,t,o){let l;for(let s in e)if("object"==typeof o){if(JSON.stringify(e[s][t])===JSON.stringify(o)){l=e[s];break}}else if(e[s][t]===o){l=e[s];break}return l},getListIndex(e,t,o){let l=-1;for(let s=0;s<e.length;s++)if(e[s][t]===o){l=s;break}return l},autoClickSku(){let e=this,{stockName:t}=e,o=e.goodsInfo[e.skuListName],l=e.goodsInfo[e.specListName];if(1==l.length){let s=l[0].list;for(let l=0;l<s.length;l++){let a=e.getListItem(o,e.skuArrName,[s[l].name]);if(a&&a[t]>0){e.skuClick(s[l],0,l);break}}}},themeColorFn(e){let t=this,{theme:o,themeColor:l}=t;return t[e]?t[e]:l[o][e]},defaultSelectSku(){let e=this,{defaultSelect:t}=e;t&&t.sku&&t.sku.length>0&&e.selectSku(t)},selectSku(e={}){let t=this,{sku:o,num:l}=e,s=t.goodsInfo[t.specListName];if(o&&s.length===o.length){let e=[],l=!0;for(let a=0;a<o.length;a++){let r=o[a],n=s[a].list,u=a,c=t.getListIndex(n,"name",r);if(-1==c){l=!1;break}e.push({spec:n[c],index1:u,index2:c})}l&&(t.init(!0),e.map((e=>{t.skuClick(e.spec,e.index1,e.index2)})))}l>0&&(t.selectNum=l)},priceFilter(e=0){return"string"==typeof e&&(e=parseFloat(e)),0===this.amountType?e.toFixed(2):(e/100).toFixed(2)},pushGoodsCache(e){let{goodsIdName:t}=this;Z[e[t]]=e},stop(){},previewImage(){let{selectShop:e,goodsInfo:t,goodsThumbName:o}=this,l=e.image?e.image:t[o];l&&g({urls:[l]})},getMaxStock(){let e=0,{selectShop:t={},goodsInfo:o={},skuListName:l,stockName:s}=this;if(t[s])e=t[s];else{let t=o[l];if(t&&t.length>0){let o=[];t.map(((e,t)=>{o.push(e[s])})),e=Math.max(...o)}}return e},numChange(e){this.$emit("num-change",e.value)}},computed:{valueCom(){return this.modelValue},maxBuyNumCom(){let e=this.getMaxStock(),t=this.maxBuyNum||1e5;return t>e&&(t=e),t},isManyCom(){let{goodsInfo:e,defaultSingleSkuName:t,specListName:o}=this,l=!0;return e[o]&&1===e[o].length&&1===e[o][0].list.length&&e[o][0].name===t&&(l=!1),l},priceCom(){let e="",t=this,{selectShop:o={},goodsInfo:l={},skuListName:s,skuIdName:a}=t;if(o[a])e=t.priceFilter(o.price);else{let o=l[s];if(o&&o.length>0){let l=[];o.map(((e,t)=>{l.push(e.price)}));let s=t.priceFilter(Math.min(...l)),a=t.priceFilter(Math.max(...l));e=s===a?s+"":`${s} - ${a}`}}return(parseFloat(e)*this.selectNum).toFixed(2)},stockCom(){let e="",{selectShop:t={},goodsInfo:o={},skuListName:l,stockName:s}=this;if(t[s])e=t[s];else{let t=o[l];if(t&&t.length>0){let o=[];t.map(((e,t)=>{o.push(e[s])}));let l=Math.min(...o),a=Math.max(...o);e=l===a?l:`${l} - ${a}`}}return e}},watch:{valueCom(e,t){e&&this.open()},defaultGoods:{immediate:!0,handler:function(e,t){let o=this,{goodsIdName:l}=o;"object"==typeof e&&e&&e[l]&&!Z[e[l]]&&o.pushGoodsCache(e)}}}},[["render",function(e,m,g,N,S,I){const T=d,w=p,A=x,B=t(o("vk-data-input-number-box"),D),F=v;return l(),i(T,{class:y(["vk-data-goods-sku-popup",I.valueCom&&S.complete?"show":"none"]),catchtouchmove:"true",onTouchmove:_(I.moveHandle,["stop","prevent"]),onClick:_(I.stop,["stop"])},{default:r((()=>[b(" 页面内容开始 "),a(T,{class:"mask",onClick:m[0]||(m[0]=e=>I.close("mask"))}),a(T,{class:y(["layer attr-content",{"safe-area-inset-bottom":g.safeAreaInsetBottom}]),style:k({borderRadius:g.borderRadius+"rpx "+g.borderRadius+"rpx 0 0"})},{default:r((()=>[a(T,{class:"specification-wrapper"},{default:r((()=>[a(F,{class:"specification-wrapper-content","scroll-y":"true"},{default:r((()=>[a(T,{class:"specification-header"},{default:r((()=>[a(T,{class:"specification-left"},{default:r((()=>[a(w,{class:"product-img",src:S.selectShop.image?S.selectShop.image:S.goodsInfo[g.goodsThumbName],style:k({backgroundColor:g.goodsThumbBackgroundColor}),mode:"aspectFill",onClick:I.previewImage},null,8,["src","style","onClick"])])),_:1}),a(T,{class:"specification-right"},{default:r((()=>[a(T,{class:"price-content",style:k({color:I.themeColorFn("priceColor")})},{default:r((()=>[a(A,{class:"sign"},{default:r((()=>[n("¥")])),_:1}),a(A,{class:y(["price",I.priceCom.length>16?"price2":""])},{default:r((()=>[n(f(I.priceCom),1)])),_:1},8,["class"])])),_:1},8,["style"]),g.hideStock?(l(),i(T,{key:1,class:"inventory"})):(l(),i(T,{key:0,class:"inventory"},{default:r((()=>[n(f(g.stockText)+"："+f(I.stockCom),1)])),_:1})),h(a(T,{class:"choose"},{default:r((()=>[n("已选："+f(S.selectArr.join(" ")),1)])),_:1},512),[[C,I.isManyCom]])])),_:1})])),_:1}),a(T,{class:"specification-content"},{default:r((()=>[(l(!0),s(u,null,c(S.goodsInfo[g.specListName],((e,t)=>h((l(),i(T,{class:"specification-item",key:t},{default:r((()=>[a(T,{class:"item-title"},{default:r((()=>[n(f(e.name),1)])),_:2},1024),a(T,{class:"item-wrapper"},{default:r((()=>[(l(!0),s(u,null,c(e.list,((e,o)=>(l(),i(T,{class:y(["item-content",[e.ishow?"":"noactived",S.subIndex[t]==o?"actived":""]]),key:o,style:k([e.ishow?"":I.themeColorFn("disableStyle"),e.ishow?I.themeColorFn("btnStyle"):"",S.subIndex[t]==o?I.themeColorFn("activedStyle"):""]),onClick:l=>I.skuClick(e,t,o)},{default:r((()=>[n(f(e.name),1)])),_:2},1032,["class","style","onClick"])))),128))])),_:2},1024)])),_:2},1024)),[[C,I.isManyCom]]))),128)),a(T,{class:"number-box-view"},{default:r((()=>[a(T,{style:{flex:"1"}},{default:r((()=>[n("数量")])),_:1}),a(T,{style:{flex:"4","text-align":"right"}},{default:r((()=>[a(B,{modelValue:S.selectNum,"onUpdate:modelValue":m[1]||(m[1]=e=>S.selectNum=e),min:g.minBuyNum||1,max:I.maxBuyNumCom,step:g.stepBuyNum||1,"step-strictly":g.stepStrictly,"positive-integer":!0,onChange:I.numChange},null,8,["modelValue","min","max","step","step-strictly","onChange"])])),_:1})])),_:1})])),_:1})])),_:1}),0!=g.showClose?(l(),i(T,{key:0,class:"close",onClick:m[2]||(m[2]=e=>I.close("close"))},{default:r((()=>[a(w,{class:"close-item",src:g.closeImage},null,8,["src"])])),_:1})):b("v-if",!0)])),_:1}),S.outFoStock||4==g.mode?(l(),i(T,{key:0,class:"btn-wrapper"},{default:r((()=>[a(T,{class:"sure",style:{color:"#ffffff","background-color":"#cccccc"}},{default:r((()=>[n(f(g.noStockText),1)])),_:1})])),_:1})):1==g.mode?(l(),i(T,{key:1,class:"btn-wrapper"},{default:r((()=>[a(T,{class:"sure add-cart",style:k([{"border-radius":"38rpx 0rpx 0rpx 38rpx"},{color:I.themeColorFn("addCartColor"),backgroundColor:I.themeColorFn("addCartBackgroundColor")}]),onClick:I.addCart},{default:r((()=>[n(f(g.addCartText),1)])),_:1},8,["style","onClick"]),a(T,{class:"sure",style:k([{"border-radius":"0rpx 38rpx 38rpx 0rpx"},{color:I.themeColorFn("buyNowColor"),backgroundColor:I.themeColorFn("buyNowBackgroundColor")}]),onClick:I.buyNow},{default:r((()=>[n(f(g.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):2==g.mode?(l(),i(T,{key:2,class:"btn-wrapper"},{default:r((()=>[a(T,{class:"sure add-cart",style:k({color:I.themeColorFn("addCartColor"),background:I.themeColorFn("addCartBackgroundColor")}),onClick:I.addCart},{default:r((()=>[n(f(g.addCartText),1)])),_:1},8,["style","onClick"])])),_:1})):3==g.mode?(l(),i(T,{key:3,class:"btn-wrapper"},{default:r((()=>[a(T,{class:"sure",style:k({color:I.themeColorFn("buyNowColor"),background:I.themeColorFn("buyNowBackgroundColor")}),onClick:I.buyNow},{default:r((()=>[n(f(g.buyNowText),1)])),_:1},8,["style","onClick"])])),_:1})):b("v-if",!0)])),_:1},8,["class","style"]),b(" 页面内容结束 ")])),_:1},8,["class","onTouchmove","onClick"])}],["__scopeId","data-v-552b2e6f"]]);var W=(e=>(e[e.Both=1]="Both",e[e.Cart=2]="Cart",e[e.Buy=3]="Buy",e))(W||{});const ee=N("mode",(()=>{const e=S(1);return{skuMode:e,setSkuMode:t=>{e.value=t}}}),{persist:!0}),te=e({__name:"detail-sku",props:{goods:null,modelValue:null,addressId:null},emits:["update:modelValue"],setup(e,{expose:s,emit:a}){const r=e,n=S(!1),u=S(),c=S(),d=ee(),{skuMode:f}=I(d),p=M(r.goods);T((()=>r.goods),(()=>{const e=p.specs.map((e=>({name:e.name,list:e.values})));for(const t of e)t.list.sort(((e,t)=>e.name.localeCompare(t.name)));u.value={_id:p.id,name:p.name,goods_thumb:p.mainPictures[0],spec_list:e,sku_list:p.skus.map((e=>({_id:e.id,goods_id:p.id,goods_name:p.name,image:e.picture,price:parseInt(e.price),stock:e.inventory,sku_name_arr:e.specs.map((e=>e.valueName))})))}}),{immediate:!0});const g=()=>{var e,t;const o=null==(t=null==(e=c.value)?void 0:e.selectArr)?void 0:t.join(" ").trim();a("update:modelValue","/"==o?"":o)};function b(e){!async function(e){await $({count:e.buy_num,skuId:e._id}),m({title:"加入购物车成功",icon:"none"}),n.value=!1}(e)}async function y(e){r.addressId?B({url:`/sub-pages/order/order?id=${e._id}&count=${e.buy_num}&addressId=${r.addressId}`}):B({url:`/sub-pages/order/order?id=${e._id}&count=${e.buy_num}`}),n.value=!1}return s({openOrClose:e=>{n.value=e}}),(e,s)=>{const a=t(o("vk-data-goods-sku-popup"),Y);return l(),i(a,{ref_key:"skuPopupRef",ref:c,modelValue:w(n),"onUpdate:modelValue":s[0]||(s[0]=e=>A(n)?n.value=e:null),"border-radius":"20",localdata:w(u),mode:w(f),"amount-type":0,"buy-now-background-color":"linear-gradient(90deg, #FE6035, #EF1224)","add-cart-background-color":"linear-gradient(90deg, #FFCD1E, #FF8A18)",onClose:g,onAddCart:b,onBuyNow:y},null,8,["modelValue","localdata","mode"])}}}),oe=e({__name:"detail-service",setup(e){const t=[{title:"无忧退货",content:"自收到商品之日起30天内，可在线申请无忧退货服务（食品等特殊商品除外）"},{title:"快速退款",content:"收到退货包裹并确认无误后，将在48小时内办理退款， 退款将原路返回，不同银行处理时间不同，预计1-5个工作日到账 "},{title:"满88元免邮费",content:"单笔订单金额(不含运费)满88元可免邮费，不满88元， 单笔订单收取10元邮费"}];return(e,o)=>{const i=d;return l(),s(u,null,[b(" 内容 "),a(i,{class:"px-2"},{default:r((()=>[(l(),s(u,null,c(t,(e=>a(i,{class:"item py-1.5",key:e.title},{default:r((()=>[a(i,{class:"before:content-[''] before:inline-block before:w-1.5 before:h-1.5 before:bg-[#999] before:rounded-full before:mb-0.5 before:mr-1 text-[#666]"},{default:r((()=>[n(f(e.title),1)])),_:2},1024),a(i,{class:"text-sm py-1 text-[#999] ml-2.5"},{default:r((()=>[n(f(e.content),1)])),_:2},1024)])),_:2},1024))),64))])),_:1})],2112)}}}),le=J(e({__name:"detail-address",emits:["change"],setup(e,{emit:t}){const o=P();o.getAddressListData();const{addressList:m}=I(o),g=()=>{B({url:"/sub-pages/address-form/address-form"})},b=S(0),y=e=>{t("change",e.detail.value)};return(e,t)=>{const o=p,k=d,h=F,C=V,_=v;return l(),i(k,{class:"address"},{default:r((()=>[a(_,{"scroll-y":"",class:"cart-address"},{default:r((()=>[a(C,{onChange:y},{default:r((()=>[(l(!0),s(u,null,c(w(m),((e,t)=>(l(),i(k,{class:"flex items-center py-2",key:e.id},{default:r((()=>[a(k,{class:"w-10 center"},{default:r((()=>[a(o,{src:R,class:"h-5 w-5"})])),_:1}),a(k,{class:"flex-1 text-[#666]"},{default:r((()=>[a(k,{class:"user"},{default:r((()=>[n(f(e.receiver)+" "+f(e.contact),1)])),_:2},1024),a(k,{class:"text-xs"},{default:r((()=>[n(f(e.fullLocation),1)])),_:2},1024)])),_:2},1024),a(h,{color:"#fbb957",style:{transform:"scale(0.8)"},value:e.id,checked:t===w(b)},null,8,["value","checked"])])),_:2},1024)))),128))])),_:1})])),_:1}),a(k,{class:"mt-5 bg-[#fbb957] rounded-full py-2 text-white text-center",onClick:g},{default:r((()=>[n(" 新建地址 ")])),_:1})])),_:1})}}}),[["__scopeId","data-v-eed42b08"]]),se={en:{"uni-goods-nav.options.shop":"shop","uni-goods-nav.options.cart":"cart","uni-goods-nav.buttonGroup.addToCart":"add to cart","uni-goods-nav.buttonGroup.buyNow":"buy now"},"zh-Hans":{"uni-goods-nav.options.shop":"店铺","uni-goods-nav.options.cart":"购物车","uni-goods-nav.buttonGroup.addToCart":"加入购物车","uni-goods-nav.buttonGroup.buyNow":"立即购买"},"zh-Hant":{"uni-goods-nav.options.shop":"店鋪","uni-goods-nav.options.cart":"購物車","uni-goods-nav.buttonGroup.addToCart":"加入購物車","uni-goods-nav.buttonGroup.buyNow":"立即購買"}},{t:ae}=G(se);const re=J({name:"UniGoodsNav",emits:["click","buttonClick"],props:{options:{type:Array,default:()=>[{icon:"shop",text:ae("uni-goods-nav.options.shop")},{icon:"cart",text:ae("uni-goods-nav.options.cart")}]},buttonGroup:{type:Array,default:()=>[{text:ae("uni-goods-nav.buttonGroup.addToCart"),backgroundColor:"linear-gradient(90deg, #FFCD1E, #FF8A18)",color:"#fff"},{text:ae("uni-goods-nav.buttonGroup.buyNow"),backgroundColor:"linear-gradient(90deg, #FE6035, #EF1224)",color:"#fff"}]},fill:{type:Boolean,default:!1},stat:{type:Boolean,default:!1}},methods:{onClick(e,t){this.$emit("click",{index:e,content:t})},buttonClick(e,t){uni.report&&this.stat&&uni.report(t.text,t.text),this.$emit("buttonClick",{index:e,content:t})}}},[["render",function(e,p,m,g,h,C){const _=d,v=t(o("uni-icons"),Q),N=x;return l(),i(_,{class:"uni-goods-nav"},{default:r((()=>[b(" 底部占位 "),a(_,{class:"uni-tab__seat"}),a(_,{class:"uni-tab__cart-box flex"},{default:r((()=>[a(_,{class:"flex uni-tab__cart-sub-left"},{default:r((()=>[(l(!0),s(u,null,c(m.options,((e,t)=>(l(),i(_,{key:t,class:"flex uni-tab__cart-button-left uni-tab__shop-cart",onClick:o=>C.onClick(t,e)},{default:r((()=>[a(_,{class:"uni-tab__icon"},{default:r((()=>[a(v,{type:e.icon,size:"20",color:"#646566"},null,8,["type"]),b(' <image class="image" :src="item.icon" mode="widthFix" /> ')])),_:2},1024),a(N,{class:"uni-tab__text"},{default:r((()=>[n(f(e.text),1)])),_:2},1024),a(_,{class:"flex uni-tab__dot-box"},{default:r((()=>[e.info?(l(),i(N,{key:0,class:y([{"uni-tab__dots":e.info>9},"uni-tab__dot"]),style:k({backgroundColor:e.infoBackgroundColor?e.infoBackgroundColor:"#ff0000",color:e.infoColor?e.infoColor:"#fff"})},{default:r((()=>[n(f(e.info),1)])),_:2},1032,["class","style"])):b("v-if",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),a(_,{class:y([{"uni-tab__right":m.fill},"flex uni-tab__cart-sub-right"])},{default:r((()=>[(l(!0),s(u,null,c(m.buttonGroup,((e,t)=>(l(),i(_,{key:t,style:k({background:e.backgroundColor,color:e.color}),class:"flex uni-tab__cart-button-right",onClick:o=>C.buttonClick(t,e)},{default:r((()=>[a(N,{style:k({color:e.color}),class:"uni-tab__cart-button-right-text"},{default:r((()=>[n(f(e.text),1)])),_:2},1032,["style"])])),_:2},1032,["style","onClick"])))),128))])),_:1},8,["class"])])),_:1})])),_:1})}],["__scopeId","data-v-36a56607"]]),ne=J(e({__name:"detail-content",props:{goods:null},setup(e){const c=S(),p=S("选购"),g=S(),y=ee(),k=e=>{var t,o;"选购"==e?(y.setSkuMode(W.Both),null==(t=g.value)||t.openOrClose(!0)):null==(o=c.value)||o.open(),p.value=e},h=S(""),C=e=>{var t;null==(t=g.value)||t.openOrClose(!0),0==e.index?y.setSkuMode(W.Cart):1==e.index&&y.setSkuMode(W.Buy)},_=e=>{2==e.index?j({url:"/pages/cart/cart"}):m({title:"暂未开发",icon:"none"})},x=S([{icon:"chat",text:"客服"},{icon:"shop",text:"店铺",infoBackgroundColor:"#007aff",infoColor:"#f5f5f5"},{icon:"cart",text:"购物车"}]),v=[{text:"加入购物车",backgroundColor:"linear-gradient(90deg, #FFCD1E, #FF8A18)",color:"#fff"},{text:"立即购买",backgroundColor:"linear-gradient(90deg, #FE6035, #EF1224)",color:"#fff"}],N=P(),{addressList:T}=I(N),B=S(""),F=S(""),V=e=>{var t;F.value=e,B.value=(null==(t=T.value)?void 0:t.find((t=>t.id==e)).fullLocation)||""};return(m,y)=>{const N=d,S=le,I=oe,T=t(o("app-popup"),U),G=t(o("uni-goods-nav"),re),j=te;return l(),s(u,null,[a(N,{class:"bg-[#fff]"},{default:r((()=>[a(N,{class:"flex items-center px-4 py-2 bg-[#fbb957] text-white"},{default:r((()=>[a(N,null,{default:r((()=>[n("¥")])),_:1}),a(N,{class:"text-2xl ml-0.5"},{default:r((()=>[n(f(e.goods.price),1)])),_:1})])),_:1}),a(N,{class:"px-2 py-3 b-bottom"},{default:r((()=>[a(N,{class:"text-[#333] truncate"},{default:r((()=>[n(f(e.goods.name),1)])),_:1}),a(N,{class:"mt-1 text-[#f00] text-sm truncate"},{default:r((()=>[n(f(e.goods.desc),1)])),_:1})])),_:1}),a(N,{class:"between px-4 py-3 b-bottom",onClick:y[0]||(y[0]=e=>k("选购"))},{default:r((()=>[a(N,{class:"flex w-[calc(100%-23px)]"},{default:r((()=>[a(N,{class:"text-gray mr-3 w-10"},{default:r((()=>[n("选择")])),_:1}),a(N,{class:"truncate text-[#666] w-[calc(100%-40px)]"},{default:r((()=>[n(f(w(h)||"请选择商品规格"),1)])),_:1})])),_:1}),a(N,{class:"i-carbon-chevron-right text-gray-300 text-lg"})])),_:1}),a(N,{class:"between px-4 py-3 b-bottom",onClick:y[1]||(y[1]=e=>k("配送至"))},{default:r((()=>[a(N,{class:"flex"},{default:r((()=>[a(N,{class:"text-gray mr-3 w-10"},{default:r((()=>[n("送至")])),_:1}),a(N,{class:"truncate text-[#666]"},{default:r((()=>[n(f(""==w(B)?"请选择收获地址":w(B)),1)])),_:1})])),_:1}),a(N,{class:"i-carbon-chevron-right text-gray-300 text-lg"})])),_:1}),a(N,{class:"between px-4 py-3 b-bottom",onClick:y[2]||(y[2]=e=>k("服务说明"))},{default:r((()=>[a(N,{class:"flex"},{default:r((()=>[a(N,{class:"text-gray mr-3 w-10"},{default:r((()=>[n("服务")])),_:1}),a(N,{class:"truncate text-[#666]"},{default:r((()=>[n("无忧退 快速退款 免费包邮 ")])),_:1})])),_:1}),a(N,{class:"i-carbon-chevron-right text-gray-300 text-lg"})])),_:1}),a(T,{ref_key:"popupRef",ref:c,title:w(p)},{default:r((()=>["选购"==w(p)?(l(),i(N,{key:0,class:"h-20 bg-blue"})):b("v-if",!0),"配送至"==w(p)?(l(),i(S,{key:1,onChange:V})):b("v-if",!0),"服务说明"==w(p)?(l(),i(I,{key:2})):b("v-if",!0)])),_:1},8,["title"])])),_:1}),a(N,{class:"goods-carts"},{default:r((()=>[a(G,{onClick:_,options:w(x),fill:!0,"button-group":v,onButtonClick:C},null,8,["options"])])),_:1}),a(j,{modelValue:w(h),"onUpdate:modelValue":y[3]||(y[3]=e=>A(h)?h.value=e:null),goods:e.goods,ref_key:"detailSkuRef",ref:g,addressId:w(F)},null,8,["modelValue","goods","addressId"])],64)}}}),[["__scopeId","data-v-5e4c7c19"]]),ue=e({__name:"detail-swiper",props:{urls:null},setup(e){const t=e,o=S(0),m=e=>{o.value=e.detail.current};return(b,y)=>{const k=p,h=L,C=O,_=d;return l(),i(_,{class:"relative"},{default:r((()=>[a(C,{class:"h-90",autoplay:"",circular:"",current:w(o),onChange:m},{default:r((()=>[(l(!0),s(u,null,c(e.urls,(e=>(l(),i(h,{key:e},{default:r((()=>[a(k,{src:e,class:"w-full h-full",mode:"aspectFill",onClick:o=>(e=>{g({current:e,urls:t.urls})})(e)},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:1},8,["current"]),a(_,{class:"absolute right-2 bottom-3 center text-sm px-3 py-0.5 w-fit rounded-full bg-[#000] text-white opacity-40"},{default:r((()=>[a(_,null,{default:r((()=>[n(f(w(o)+1),1)])),_:1}),a(_,{class:"mx-0.5"},{default:r((()=>[n("/")])),_:1}),a(_,null,{default:r((()=>{var t;return[n(f(null==(t=e.urls)?void 0:t.length),1)]})),_:1})])),_:1})])),_:1})}}}),ce=J(e({__name:"detail",props:{id:null},setup(e){!async function(e){const{result:t}=await(e=>K({url:"/goods",data:{id:e}}))(e);console.log(t,"result"),s.value=t}(e.id);const s=S();return(e,n)=>{const u=ue,c=ne,f=z,p=q,m=t(o("app-scroll-view"),H),g=d;return w(s)?(l(),i(g,{key:0,class:"h-100% overflow-hidden"},{default:r((()=>[a(m,{class:"!h-[calc(100%-50px)] !overflow-hidden","refresher-enabled":!1,"padding-bottom":50},{default:r((()=>{var e,t,o,l,r,n;return[a(u,{urls:null==(e=w(s))?void 0:e.mainPictures},null,8,["urls"]),a(c,{goods:w(s)},null,8,["goods"]),a(f,{desc:null==(o=null==(t=w(s))?void 0:t.details)?void 0:o.properties,pictures:null==(r=null==(l=w(s))?void 0:l.details)?void 0:r.pictures},null,8,["desc","pictures"]),a(p,{goods:null==(n=w(s))?void 0:n.similarProducts},null,8,["goods"])]})),_:1})])),_:1})):b("v-if",!0)}}}),[["__scopeId","data-v-85236dee"]]);export{ce as default};